<html>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>


<script type="text/javascript">

$(document).ready(function() {

  // define a generic Ajax error handler:
  // http://api.jquery.com/ajaxerror/
  $(document).ajaxError(function() {
    alert("Sorry, there was a problem!");
  });



  function getCookie(c_name) {
    if (document.cookie.length > 0) {
        c_start = document.cookie.indexOf(c_name + "=");
        if (c_start != -1) {
            c_start = c_start + c_name.length + 1;
            c_end = document.cookie.indexOf(";", c_start);
            if (c_end == -1) {
                c_end = document.cookie.length;
            }
            return unescape(document.cookie.substring(c_start, c_end));
        }
    }
    return "";
}
  window.onload = function(){
    var x = getCookie("username");
    $.ajax({
      // The URL for the request -- note the simple REST API!
      // all URLs are relative to http://localhost:3000/
      url: "users/" + x,
      type: "GET",
      dataType : "json", // this URL returns data in JSON format

      success: function( data ) {
        console.log("Received User Load Components", data);

        if (data.username) {
          console.log("Passing");
          document.getElementById('usernamebox').value = data.username;
          document.getElementById('firstNameBox').value = data.fname;
          document.getElementById('lastNameBox').value = data.lname;
          document.getElementById('phoneBox').value= data.phone;
          document.getElementById('gradBox').value = data.year;
        } 
        else {
          document.getElementById('usernamebox').value = "";
          document.getElementById('firstNameBox').value = "";
          document.getElementById('lastNameBox').value = "";
          document.getElementById('phoneBox').value = "";
          document.getElementById('gradBox').value = "";
        }
      },
    });
}




  $("#back").click(function() {
    window.location.href = "homepage.html";
    
    });

$("#createButton").click(function() {
  $.ajax({
    url: "listing/",
    type: "POST",
    dataType: "text",

    data : {
      itemName : $("#itemName").val(),
      itemCondition :  $("#itemCondition").val(),
      itemDescription : document.getElementById('itemDescription').value,
      itemPrice : $("#priceBox").val(),
      username: document.getElementById('usernamebox').value,
      fname: $("#firstNameBox").val(),
      lname: $("#lastNameBox").val(),
      phone: $("#phoneBox").val(),
      year: $("#gradBox").val(),
      icon: $("#").val(),
      category : $("#drop").val()
    },

    
    success : function(data){
      if(data == 'OK'){
        console.log('input into db');
        $("#status").html("Successfully created a new user! return to UR market to see your listings");
      }
      else{
        console.log('error did not get into db');
        $("#status").html("Did not create listing");
      }
    }
  });
  console.log($("#itemDescription").val());
  console.log($("#usernamebox").val());


  });

















});

</script>




<head>
  <style type="text/css">
  body{ background-color: white }
  .class{color:blue; text-align: left;}
  
  div{text-align: c;}


  </style>

</head>

  <body>
  <title>UR Market Listing</title>
 
  <h1>Welcome to UR Market create listing page!</h1>
  <!--<h1>Here you can create, update or delete your accout</h1>-->

  <p> Please create your listing here!</p>
  
  <div1>
  <p0 class = "class"> Item Name: <input id="itemName" type="text" size="20"/> </p0>    
  <br>
  <br>
  <p0 class = "class"> Item Condition: <input id="itemCondition" type="text" size="20"/> </p0> 
  <br>
  <br>
  <p0 class = "class"> Price: <input id="priceBox" type="text" size="20"/> </p0>    
  <br>
  <br>
  <textarea id="itemDescription" style="width:250px;height:150px;">Item Description</textarea>  
  <br>
   <p class = "class">Item Category </P>
  <select id = "drop">
  <option value="Books">Books</option>
  <option value="Electronics">Electronics</option>
  <option value="Dorm Supplies">Dorm</option>
  <option value="Miscellaneous">Miscellaneous</option>
  </select>
  <br>
  <br>
  <p4 class = "class"> Item image URL: <input id="iconBox" type="text" size="20"/></p4>
  <br>
  <br>

  </div>
</div1>

  <div>
   <p5 class = "class"> Email: <input id="usernamebox" type="text" size="14"/> </p5>    
  <p0 class = "class"> First Name: <input id="firstNameBox" type="text" size="14"/> </p0>    
  <p1 class = "class"> Last Name: <input id="lastNameBox" type="text" size="19"/> </p1>
  <br>
  <br>
  <p2 class = "class"> Phone number: <input id="phoneBox" type="text" size="20"/> </p2>
  <br>
  <br>
  <p3 class = "class"> Graduation Year: <input id="gradBox" type="text" size="20"/></p3>
  <br>
  



   

    <p>
    <button id="createButton">Create new listing!</button>
     <button id="back">Back to Homepage</button>
     
    </p>

<!--empty place holders to show info on screen-->
    <div id = "status"></div>
 
  </body>
</html>